<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>2å­¦æœŸæœ«è©¦é¨“å¯¾ç­–</title>
<style>
    /* ã€Œæƒ…å ±ç§‘æŒ‡å°æ³•Iã€ã‹ã‚‰æŒã£ã¦ããŸCSSãƒ‡ã‚¶ã‚¤ãƒ³ã§ã™ */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0.5rem;
      background: #f9f9f9;
      color: #333;
      font-size: 18px;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin: 0.5rem 0 1rem;
    }
    .tag-btn, #nextBtn {
      display: block;
      width: 100%;
      padding: 1rem;
      margin: 0.4rem 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1.1rem;
      background: #fff;
      text-align: center;
      cursor: pointer;
    }
    .tag-btn:hover {
      background: #f0f0f0;
    }
    #question {
      margin: 0.8rem 0;
      font-size: 1.2rem;
      line-height: 1.6;
    }
    #options {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #options li {
      margin-bottom: 0.5rem;
    }
    #options button {
      width: 100%;
      padding: 1rem;
      font-size: 1.1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fff;
      text-align: left;
      cursor: pointer;
    }
    #options button:disabled {
      opacity: 0.7;
      cursor: default;
    }
    #progress {
      font-size: 0.9rem;
      text-align: center;
      margin: 0.8rem 0;
    }
    #result h2 {
      text-align: center;
      margin-top: 1.5rem;
    }
    #nextBtn {
      background: #0078d7;
      color: #fff;
      display: none;
    }
    #nextBtn:hover {
      background: #005a9e;
    }
</style>
</head>
<body>

  <h1 id="mainTitle">2å­¦æœŸæœ«è©¦é¨“å¯¾ç­–</h1>

  <div id="controls">
  Â  <button class="tag-btn" data-tag="info1">æƒ…å ±I</button>
  Â  <button class="tag-btn" data-tag="info2">æƒ…å ±II</button>
  Â  <button class="tag-btn" data-tag="appA">ã‚¢ãƒ—ãƒªA</button>
  Â  <button class="tag-btn" data-tag="appB">ã‚¢ãƒ—ãƒªB</button>
  </div>

  <div id="quiz" style="display:none;">
  Â  <div id="question"></div>
  Â  <ul id="options"></ul>
  Â  <div id="progress"></div>
  Â  <button id="nextBtn">æ¬¡ã¸ â–¶</button>
  </div>

  <div id="result" style="display:none;"></div>

<script>
  let questions=[],current=0,score=0;

  document.querySelectorAll('.tag-btn').forEach(btn=>{
  Â  btn.onclick=()=>startQuiz(btn.dataset.tag);
  });

  /**
   * loadCSVé–¢æ•°ã‚’ã€" (ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ) ã«å¯¾å¿œã—ãŸCSVãƒ‘ãƒ¼ã‚µãƒ¼ã«ç½®ãæ›ãˆã¾ã—ãŸã€‚
   */
  async function loadCSV(file){
    const text = await (await fetch(file)).text();

    // CSVã®1è¡Œã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹å†…éƒ¨é–¢æ•°
    const parseCsvLine = (line) => {
      const result = [];
      let currentField = '';
      let inQuote = false;

      for (let i = 0; i < line.length; i++) {
        const char = line[i];

        if (char === '"') {
          if (inQuote && line[i + 1] === '"') {
            // "" (ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸã‚¯ã‚©ãƒ¼ãƒˆ) ã®å ´åˆ
            currentField += '"';
            i++; // æ¬¡ã® " ã‚’ã‚¹ã‚­ãƒƒãƒ—
          } else {
            // ã‚¯ã‚©ãƒ¼ãƒˆã®é–‹å§‹ã¾ãŸã¯çµ‚äº†
            inQuote = !inQuote;
          }
        } else if (char === ',' && !inQuote) {
          // ã‚¯ã‚©ãƒ¼ãƒˆã®å¤–ã®ã‚«ãƒ³ãƒ (åŒºåˆ‡ã‚Šæ–‡å­—)
          result.push(currentField);
          currentField = '';
        } else {
          // é€šå¸¸ã®æ–‡å­—
          currentField += char;
        }
      }
      result.push(currentField); // æœ€å¾Œã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 

      // å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‰å¾Œã«ã‚ã‚‹ " ã‚’å‰Šé™¤
      return result.map(field => {
        if (field.startsWith('"') && field.endsWith('"')) {
          return field.substring(1, field.length - 1).replace(/""/g, '"');
        }
        return field;
      });
    };

    return text.trim().split(/\r?\n/).slice(1).map(line => {
      if (!line) return null; // ç©ºè¡Œã‚’ç„¡è¦–
      const c = parseCsvLine(line); // æ–°ã—ã„ãƒ‘ãƒ¼ã‚¹é–¢æ•°ã‚’ä½¿ç”¨

      if (c.length < 5) return null; 

      const lastIdx = c.length - 1;
      const answerIdx = lastIdx - 1;

      return {
        q: c[1],
        options: c.slice(2, answerIdx),
        answer: +c[answerIdx] - 1,
        explanation: c[lastIdx]
      };
    }).filter(q => q !== null);
  }

  function shuffle(a){
  Â  for(let i=a.length-1;i>0;i--){
  Â  Â  const j=Math.floor(Math.random()*(i+1));
  Â  Â  [a[i],a[j]]=[a[j],a[i]];
  Â  }
  Â  return a;
  }

  function csvFileName(tag){
  Â  return {
  Â  Â  info1:'info1.csv',
  Â  Â  info2:'info2.csv',
  Â  Â  appA:'appA.csv',
  Â  Â  appB:'appB.csv'
  Â  }[tag];
  }

  async function startQuiz(tag){
  Â  document.getElementById('controls').style.display='none';
  Â  document.getElementById('mainTitle').style.display='none'; 
    
    let pool;
    try {
      pool = await loadCSV(csvFileName(tag));
    } catch(err) {
      console.error("CSV Load Error:", err);
      pool = []; 
    }

    if (!pool || pool.length === 0) {
        alert("å•é¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«åã‚„å ´æ‰€ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        document.getElementById('controls').style.display=''; 
        document.getElementById('mainTitle').style.display='block';
        return;
    }

  Â  questions=shuffle(pool).slice(0,20); 
  Â  current=score=0;
  Â  document.getElementById('result').style.display='none';
  Â  document.getElementById('quiz').style.display='';
  Â  showQuestion();
  }

  function showQuestion(){
  Â  const q=questions[current];
  Â  document.getElementById('question').textContent=q.q;
  Â  const ul=document.getElementById('options'); ul.innerHTML='';
  Â  q.options.forEach((opt,i)=>{
  Â  Â  const li=document.createElement('li');
  Â  Â  li.innerHTML=`<button>${opt}</button>`;
  Â  Â  li.firstChild.onclick=()=>selectAnswer(i);
  Â  Â  ul.appendChild(li);
  Â  });
  Â  document.getElementById('progress').textContent=`${current+1}/${questions.length}`;
  }

  function selectAnswer(idx){
  Â  const q=questions[current],ul=document.getElementById('options');
  Â  [...ul.children].forEach((li,i)=>{
  Â  Â  const b=li.firstChild; b.disabled=true;
  Â  Â  if(i===q.answer)b.style.background='lightgreen';
  Â  Â  else if(i===idx)b.style.background='salmon'; 
  Â  });
  Â  const quiz=document.getElementById('quiz');
  Â  const msg=document.createElement('p');
  Â  msg.innerHTML=(idx===q.answer
  Â  Â  ? (score++,'<span style="color:green">ğŸŸ¢ æ­£è§£ï¼</span>')
  Â  Â  : `<span style="color:red">âŒ ä¸æ­£è§£</span><br><span style="color:#555">æ­£è§£: ${q.options[q.answer]}</span>`);
  Â  // â†“â†“â†“â†“ ä¿®æ­£ç‚¹ï¼šã“ã“ã«ã‚ã£ãŸ 's' ã‚’å‰Šé™¤ã—ã¾ã—ãŸ â†“â†“â†“â†“
  Â  const exp=document.createElement('p'); exp.textContent="è§£èª¬: "+q.explanation;
  Â  quiz.append(msg,exp);
  Â  const next=document.getElementById('nextBtn');
  Â  next.style.display='block';
  Â  next.onclick=()=>{
  Â  	msg.remove(); exp.remove(); next.style.display='none';
  Â  	if(++current<questions.length)showQuestion(); else showResults();
  Â  };
  }

  function showResults(){
  Â  document.getElementById('quiz').style.display='none';
  Â  const r=document.getElementById('result');
  s  r.innerHTML=`<h2>çµæœ: ${score}/${questions.length}</h2>`;
  Â  r.style.display='';
  Â  document.getElementById('controls').style.display='';
  Â  document.getElementById('mainTitle').style.display='block';
  }
</script>
</body>
</html>
