<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>2å­¦æœŸæœ«è©¦é¨“å¯¾ç­–</title>
<style>
  /* ã“ã®CSSã¯ã€æœ€åˆã«ã”æç¤ºã„ãŸã ã„ãŸ
    ã‚¹ãƒãƒ›å‘ã‘ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ18pxåŸºæº–ã€å¤§ãã„ãƒœã‚¿ãƒ³ï¼‰ã®ã¾ã¾ã§ã™ã€‚
  */
Â  body {
Â  Â  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
Â  Â  margin: 0;
Â  Â  padding: 0.5rem;
Â  Â  background: #f9f9f9;
Â  Â  color: #333;
Â  Â  font-size: 18px;Â  Â /* ã‚¹ãƒãƒ›å‘ã‘ã«18pxåŸºæº– */
Â  Â  line-height: 1.6;
Â  }
Â  h1 { text-align:center; font-size:1.8rem; margin:0.5rem 0 1rem; }
Â  .tag-btn, #nextBtn {
Â  Â  display:block; width:100%; padding:1rem; margin:0.4rem 0;
Â  Â  border:1px solid #ccc; border-radius:6px; font-size:1.1rem; background:#fff;
Â  }
Â  #question { margin:0.8rem 0; font-size:1.2rem; line-height:1.6; }
Â  #options { list-style:none; padding:0; margin:0; }
Â  #options li { margin-bottom:0.5rem; }
Â  #options button {
Â  Â  width:100%; padding:1rem; font-size:1.1rem;
Â  Â  border:1px solid #ccc; border-radius:6px; background:#fff; text-align:left;
Â  }
Â  #options button:disabled { opacity:0.7; }
Â  #progress { font-size:0.9rem; text-align:center; margin:0.8rem 0; }
Â  #result h2 { text-align:center; margin-top:1.5rem; }
Â  #nextBtn { background:#0078d7; color:#fff; display:none; }
Â  #nextBtn:hover { background:#005a9e; }
</style>
</head>
<body>

<h1 id="mainTitle">2å­¦æœŸæœ«è©¦é¨“å¯¾ç­–</h1>

<div id="controls">
Â  <button class="tag-btn" data-tag="info1">æƒ…å ±I</button>
Â  <button class="tag-btn" data-tag="info2">æƒ…å ±II</button>
Â  <button class="tag-btn" data-tag="appA">ã‚¢ãƒ—ãƒªA</button>
Â  <button class="tag-btn" data-tag="appB">ã‚¢ãƒ—ãƒªB</button>
</div>

<div id="quiz" style="display:none;">
Â  <div id="question"></div>
Â  <ul id="options"></ul>
Â  <div id="progress"></div>
Â  <button id="nextBtn">æ¬¡ã¸ â–¶</button>
</div>

<div id="result" style="display:none;"></div>

<script>
/* ã“ã®JavaScriptã¯ã€é¸æŠè‚¢ã®å¯å¤‰å¯¾å¿œã€
  ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒè¿½åŠ ã•ã‚ŒãŸæœ€æ–°ç‰ˆã§ã™ã€‚
*/
let questions=[],current=0,score=0;

document.querySelectorAll('.tag-btn').forEach(btn=>{
Â  btn.onclick=()=>startQuiz(btn.dataset.tag);
});

/**
Â * CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€å•é¡Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’è¿”ã—ã¾ã™ã€‚
Â * (å¤‰æ›´ç‚¹ï¼šé¸æŠè‚¢å¯å¤‰å¯¾å¿œã€é›£æ˜“åº¦å‰Šé™¤ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ )
Â */
async function loadCSV(file){
  try {
    const text=await (await fetch(file)).text();
    return text.trim().split(/\r?\n/).slice(1).map(line=>{
      const c=line.split(",");
      // ID(0), å•(1), é¸æŠè‚¢1(2), ç­”(3), è§£èª¬(4) -> æœ€ä½5åˆ—
      if (c.length < 5) return null; 

      const lastIdx = c.length - 1;
      const answerIdx = lastIdx - 1;

      return {
        q: c[1], // 1åˆ—ç›®: å•é¡Œæ–‡
        // 2åˆ—ç›®ã‹ã‚‰ã€Œç­”ãˆã€ã®åˆ—ã®ç›´å‰ã¾ã§ã‚’é¸æŠè‚¢
        options: c.slice(2, answerIdx),
        // æœ€å¾Œã‹ã‚‰2ç•ªç›®ã®åˆ—ã‚’ã€Œç­”ãˆã€ (1å§‹ã¾ã‚Šãªã®ã§ -1 ã™ã‚‹)
        answer: +c[answerIdx] - 1,
        // æœ€å¾Œã®åˆ—ã‚’ã€Œè§£èª¬ã€
        explanation: c[lastIdx]
      };
    }).filter(q => q !== null); // ä¸æ­£ãªè¡Œ(null)ã‚’å–ã‚Šé™¤ã
  } catch (err) {
    console.error("CSV load error:", err);
    alert("å•é¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«åã‚„å ´æ‰€ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
    // ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã‚‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å†è¡¨ç¤º
    document.getElementById('controls').style.display=''; 
    document.getElementById('mainTitle').style.display='block';
    return []; // ç©ºã®é…åˆ—ã‚’è¿”ã™
  }
}

function shuffle(a){
Â  for(let i=a.length-1;i>0;i--){
Â  Â  const j=Math.floor(Math.random()*(i+1));
Â  Â  [a[i],a[j]]=[a[j],a[i]];
Â  }
Â  return a;
}

function csvFileName(tag){
Â  return {
Â  Â  info1:'info1.csv',
Â  Â  info2:'info2.csv',
Â  Â  appA:'appA.csv',
Â  Â  appB:'appB.csv'
Â  }[tag];
}

async function startQuiz(tag){
Â  document.getElementById('controls').style.display='none';
Â  document.getElementById('mainTitle').style.display='none'; // ã‚¿ã‚¤ãƒˆãƒ«éè¡¨ç¤º
Â  
  const pool=await loadCSV(csvFileName(tag));
  // poolãŒç©ºï¼ˆèª­è¾¼å¤±æ•—ï¼‰ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„
  if (!pool || pool.length === 0) return; 

Â  questions=shuffle(pool).slice(0,20); // å„æˆæ¥­20å•å›ºå®š
Â  current=score=0;
Â  document.getElementById('result').style.display='none';
Â  document.getElementById('quiz').style.display='';
Â  showQuestion();
}

function showQuestion(){
Â  const q=questions[current];
Â  document.getElementById('question').textContent=q.q;
Â  const ul=document.getElementById('options'); ul.innerHTML='';
Â  q.options.forEach((opt,i)=>{
Â  Â  const li=document.createElement('li');
Â  Â  li.innerHTML=`<button>${opt}</button>`;
Â  Â  li.firstChild.onclick=()=>selectAnswer(i);
Â  Â  ul.appendChild(li);
Â  });
Â  document.getElementById('progress').textContent=`${current+1}/${questions.length}`;
}

function selectAnswer(idx){
Â  const q=questions[current],ul=document.getElementById('options');
Â  [...ul.children].forEach((li,i)=>{
Â  Â  const b=li.firstChild; b.disabled=true;
Â  Â  if(i===q.answer)b.style.background='lightgreen';
Â  Â  else if(i===idx)b.style.background='salmon';
Â  });
Â  const quiz=document.getElementById('quiz');
Â  
  const msg=document.createElement('p');
  // (å¤‰æ›´ç‚¹ï¼šå¯èª­æ€§å‘ä¸Šã®ãŸã‚ifæ–‡ã«å¤‰æ›´)
  if (idx === q.answer) {
    score++;
    msg.innerHTML = '<span style="color:green">ğŸŸ¢ æ­£è§£ï¼</span>';
  } else {
    msg.innerHTML = `<span style="color:red">âŒ ä¸æ­£è§£</span><br><span style="color:#555">æ­£è§£: ${q.options[q.answer]}</span>`;
  }

Â  const exp=document.createElement('p'); exp.textContent="è§£èª¬: "+q.explanation;
Â  quiz.append(msg,exp);
Â  const next=document.getElementById('nextBtn');
Â  next.style.display='block';
Â  next.onclick=()=>{
Â  Â  msg.remove(); exp.remove(); next.style.display='none';
Â  Â  if(++current<questions.length)showQuestion(); else showResults();
Â  };
}

function showResults(){
Â  document.getElementById('quiz').style.display='none';
Â  const r=document.getElementById('result');
Â  r.innerHTML=`<h2>çµæœ: ${score}/${questions.length}</h2>`;
Â  r.style.display='';
Â  document.getElementById('controls').style.display='';
Â  document.getElementById('mainTitle').style.display='block'; // ã‚¿ã‚¤ãƒˆãƒ«å†è¡¨ç¤º
}
</script>
</body>
</html>
