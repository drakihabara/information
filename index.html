<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>2学期末試験対策</title>
<style>
    /* 「情報科指導法I」から持ってきたCSSデザインです */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0.5rem;
      background: #f9f9f9;
      color: #333;
      font-size: 18px;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin: 0.5rem 0 1rem;
    }
    .tag-btn, #nextBtn {
      display: block;
      width: 100%;
      padding: 1rem;
      margin: 0.4rem 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1.1rem;
      background: #fff;
      text-align: center;
      cursor: pointer;
    }
    .tag-btn:hover {
      background: #f0f0f0;
    }
    #question {
      margin: 0.8rem 0;
      font-size: 1.2rem;
      line-height: 1.6;
    }
    #options {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #options li {
      margin-bottom: 0.5rem;
    }
    #options button {
      width: 100%;
      padding: 1rem;
      font-size: 1.1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fff;
      text-align: left;
      cursor: pointer;
    }
    #options button:disabled {
      opacity: 0.7;
      cursor: default;
    }
    #progress {
      font-size: 0.9rem;
      text-align: center;
      margin: 0.8rem 0;
    }
    #result h2 {
      text-align: center;
      margin-top: 1.5rem;
    }
    #nextBtn {
      background: #0078d7;
      color: #fff;
      display: none;
    }
    #nextBtn:hover {
      background: #005a9e;
    }
</style>
</head>
<body>

  <h1 id="mainTitle">2学期末試験対策</h1>

  <div id="controls">
    <button class="tag-btn" data-tag="info1">情報I</button>
    <button class="tag-btn" data-tag="info2">情報II</button>
    <button class="tag-btn" data-tag="appA">アプリA</button>
    <button class="tag-btn" data-tag="appB">アプリB</button>
  </div>

  <div id="quiz" style="display:none;">
    <div id="question"></div>
    <ul id="options"></ul>
    <div id="progress"></div>
    <button id="nextBtn">次へ ▶</button>
  </div>

  <div id="result" style="display:none;"></div>

<script>
  let questions=[],current=0,score=0;

  document.querySelectorAll('.tag-btn').forEach(btn=>{
    btn.onclick=()=>startQuiz(btn.dataset.tag);
  });

  /**
   * loadCSV関数を、" (ダブルクォート) に対応したCSVパーサーに置き換えました。
   */
  async function loadCSV(file){
    const text = await (await fetch(file)).text();

    // CSVの1行をパースする内部関数
    const parseCsvLine = (line) => {
      const result = [];
      let currentField = '';
      let inQuote = false;

      for (let i = 0; i < line.length; i++) {
        const char = line[i];

        if (char === '"') {
          if (inQuote && line[i + 1] === '"') {
            // "" (エスケープされたクォート) の場合
            currentField += '"';
            i++; // 次の " をスキップ
          } else {
            // クォートの開始または終了
            inQuote = !inQuote;
          }
        } else if (char === ',' && !inQuote) {
          // クォートの外のカンマ (区切り文字)
          result.push(currentField);
          currentField = '';
        } else {
          // 通常の文字
          currentField += char;
        }
      }
      result.push(currentField); // 最後のフィールドを追加

      // 各フィールドの前後にある " を削除
      return result.map(field => {
        if (field.startsWith('"') && field.endsWith('"')) {
          return field.substring(1, field.length - 1).replace(/""/g, '"');
        }
        return field;
      });
    };

    return text.trim().split(/\r?\n/).slice(1).map(line => {
      if (!line) return null; // 空行を無視
      const c = parseCsvLine(line); // 新しいパース関数を使用

      if (c.length < 5) return null; 

      const lastIdx = c.length - 1;
      const answerIdx = lastIdx - 1;

      return {
        q: c[1],
        options: c.slice(2, answerIdx),
        answer: +c[answerIdx] - 1,
        explanation: c[lastIdx]
      };
    }).filter(q => q !== null);
  }

  function shuffle(a){
    for(let i=a.length-1;i>0;
